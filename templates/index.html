<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Audion't</title>
    <link rel="stylesheet" href="static/style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  </head>
  <body>
    <div id="app-container">
      <div id="logo" style="width: 100%">
        <img src="static/audiont.jpg" style="width: 100%" alt="logo" />
      </div>

      <div class="module" name="Funciones">
        <!-- BotÃ³n de Subir audio-->
        <button
          id="upload-btn"
          onclick="document.getElementById('upload').click()"
        >
          Subir audio
        </button>
        <input type="file" id="upload" style="display: none" />

      </div>

      <div id="message">
        <p></p>
      </div>
    </div>

    <script type="text/javascript">
      // app prefix
      let app_prefix = "/audiont";

      // Add module names to the UI
      function addModuleNames() {
        let modules = document.getElementsByClassName("module");
        for (let i = 0; i < modules.length; i++) {
          let name = modules[i].getAttribute("name");
          let div = document.createElement("div");
          div.innerHTML = name;
          div.className = "module-name";
          modules[i].prepend(div);
        }
      }

      // When user adds a file, upload it to the server
      document.getElementById("upload").addEventListener("change", function () {
        // check if the file is less than 50MB
        if (this.files[0].size > 50000000) {
          alert("El archivo es demasiado grande");
          return;
        }

        // create a random number to use as the image id
        let id = Math.floor(Math.random() * 1000000000);

        // upload the audio to the server
        let formData = new FormData();
        formData.append("file", this.files[0]);
        fetch(app_prefix + "/upload_audio/" + id, {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((json) => {
            //print the response
            if (json["status"] == "success") {
              // show the link to the user upload
              let message = document.querySelector("#message p");
              message.innerHTML = json["message"];

              fetch(app_prefix + "/start_transcription/" + id, {
                method: "POST",
              })
                .then((response) => response.json())
                .then((json) => {
                  if (json["status"] == "transcription_started") {
                    // Handle response (if needed)
                    console.log("Transcription started!");
                  }
                });
            } else {
              alert(json["error"]);
            }
          });
      });
    </script>
  </body>
</html>
